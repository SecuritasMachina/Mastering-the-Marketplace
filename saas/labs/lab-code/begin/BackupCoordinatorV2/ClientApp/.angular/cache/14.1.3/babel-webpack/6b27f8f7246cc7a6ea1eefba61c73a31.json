{"ast":null,"code":"import _asyncToGenerator from \"C:/data/source/Mastering-the-Marketplace/saas/labs/lab-code/begin/BackupCoordinatorV2/ClientApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\n\nfunction DirListingComponent_p_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\")(1, \"em\");\n    i0.ɵɵtext(2, \"Loading...\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction DirListingComponent_table_3_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\")(2, \"a\", 5);\n    i0.ɵɵlistener(\"click\", function DirListingComponent_table_3_tr_12_Template_a_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const fileDTO_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.restoreFile(fileDTO_r3.FileName));\n    });\n    i0.ɵɵtext(3, \"Restore\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const fileDTO_r3 = ctx.$implicit;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(fileDTO_r3.FileName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fileDTO_r3.length);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(fileDTO_r3.date);\n  }\n}\n\nfunction DirListingComponent_table_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 3)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Action\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"FileName\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Size\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Date\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"tbody\");\n    i0.ɵɵtemplate(12, DirListingComponent_table_3_tr_12_Template, 10, 3, \"tr\", 4);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.dirListingDTO);\n  }\n}\n\nexport class DirListingComponent {\n  // const options = new RequestOptions({ headers: this.headers });\n  constructor(http, _Activatedroute) {\n    //var guid = 'ab50c41e-3814-4533-8f68-a691b4da9043';\n    this._Activatedroute = _Activatedroute;\n    this.dirListingDTO = [];\n    this.genericMsg = {};\n    this.headers = new Headers({\n      'Accept': 'application/json',\n      'enctype': 'multipart/form-data'\n    });\n    this.guid = \"ab50c41e-3814-4533-8f68-a691b4da9043\";\n    console.info('environment.appServerURL', environment.appServerURL);\n    http.get(environment.appServerURL + '/api/v3/getCache/dirListing-' + this.guid).subscribe(result => {\n      console.info('result', result);\n      this.genericMsg.msg = result.msg;\n      this.genericMsg.guid = result.guid;\n      this.guid = result.guid;\n      var tmp1 = JSON.parse(this.genericMsg.msg);\n      tmp1.fileDTOs.forEach((obj, index) => {\n        // console.log('before transform, this : ' + this);\n        var fileDTO = {};\n        fileDTO.FileName = obj.FileName;\n        fileDTO.length = obj.length;\n        this.dirListingDTO.push(fileDTO);\n      }); //this.dirListingDTO = Object.assign({}, tmp1.fileDTOs); \n\n      console.info(' this.dirListingDTO', this.dirListingDTO); // console.info(' this.dirListingDTO length', this.dirListingDTO.length);\n    }, error => console.error(error));\n  }\n\n  ngOnInit() {\n    this.id = this._Activatedroute.snapshot.paramMap.get(\"id\");\n    console.log(\"this.id\", this.id);\n  }\n\n  restoreFile(pRestoreFileName) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      console.info(' pRestoreFileName', pRestoreFileName); //this.httpCall(\"POST\", pRestoreFileName)\n\n      const response = yield fetch(environment.appServerURL + \"/api/v2/requestRestore\", {\n        method: 'POST',\n        body: JSON.stringify({\n          backupName: pRestoreFileName,\n          customerGUID: _this.guid\n        }),\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: 'application/json'\n        }\n      });\n\n      if (!response.ok) {\n        throw new Error(`Error! status: ${response.status}`);\n      }\n    })();\n  }\n\n}\n\nDirListingComponent.ɵfac = function DirListingComponent_Factory(t) {\n  return new (t || DirListingComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\n\nDirListingComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: DirListingComponent,\n  selectors: [[\"app-dir-listing\"]],\n  decls: 4,\n  vars: 3,\n  consts: [[\"id\", \"tableLabel\"], [4, \"ngIf\"], [\"class\", \"table table-striped\", \"aria-labelledby\", \"tableLabel\", 4, \"ngIf\"], [\"aria-labelledby\", \"tableLabel\", 1, \"table\", \"table-striped\"], [4, \"ngFor\", \"ngForOf\"], [1, \"pure-button\", \"pure-button-primary\", 3, \"click\"]],\n  template: function DirListingComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h1\", 0);\n      i0.ɵɵtext(1);\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(2, DirListingComponent_p_2_Template, 3, 0, \"p\", 1);\n      i0.ɵɵtemplate(3, DirListingComponent_table_3_Template, 13, 1, \"table\", 2);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\"OffSite Directory Listing length:\", ctx.dirListingDTO.length, \"\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.dirListingDTO);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.dirListingDTO);\n    }\n  },\n  dependencies: [i3.NgForOf, i3.NgIf],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJkaXItbGlzdGluZy5jb21wb25lbnQuY3NzIn0= */\"]\n});","map":{"version":3,"mappings":"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","names":["environment","i0","DirListingComponent","constructor","http","_Activatedroute","Headers","console","info","appServerURL","get","guid","subscribe","result","genericMsg","msg","tmp1","JSON","parse","fileDTOs","forEach","obj","index","fileDTO","FileName","length","dirListingDTO","push","error","ngOnInit","id","snapshot","paramMap","log","restoreFile","pRestoreFileName","response","fetch","method","body","stringify","backupName","customerGUID","headers","Accept","ok","Error","status","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\data\\source\\Mastering-the-Marketplace\\saas\\labs\\lab-code\\begin\\BackupCoordinatorV2\\ClientApp\\src\\app\\Components\\dir-listing\\dir-listing.component.ts","C:\\data\\source\\Mastering-the-Marketplace\\saas\\labs\\lab-code\\begin\\BackupCoordinatorV2\\ClientApp\\src\\app\\Components\\dir-listing\\dir-listing.component.html"],"sourcesContent":["import { Component, OnInit, Inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { environment } from '../../../environments/environment';\nimport { CommonModule } from '@angular/common'\nimport { ActivatedRoute } from '@angular/router'\n@Component({\n  selector: 'app-dir-listing',\n  templateUrl: './dir-listing.component.html',\n  styleUrls: ['./dir-listing.component.css']\n})\nexport class DirListingComponent implements OnInit {\n\n  public dirListingDTO: DirListingDTO[] = [];\n  public genericMsg = {} as GenericMsg2;\n  private headers = new Headers({\n    'Accept': 'application/json',\n    'enctype': 'multipart/form-data'\n  });\n  public guid = \"ab50c41e-3814-4533-8f68-a691b4da9043\";\n  id: string | null | undefined;\r\n  // const options = new RequestOptions({ headers: this.headers });\n\n  constructor(http: HttpClient, private _Activatedroute: ActivatedRoute) {\n    //var guid = 'ab50c41e-3814-4533-8f68-a691b4da9043';\n\n    console.info('environment.appServerURL', environment.appServerURL);\n    http.get<GenericMsg>(environment.appServerURL + '/api/v3/getCache/dirListing-' + this.guid).subscribe(result => {\n      console.info('result', result);\n      this.genericMsg.msg = result.msg;\n      this.genericMsg.guid = result.guid;\n      this.guid = result.guid;\n\n      var tmp1 = JSON.parse(this.genericMsg.msg);\n      tmp1.fileDTOs.forEach((obj: any, index: any) => {\n        // console.log('before transform, this : ' + this);\n        var fileDTO = {} as DirListingDTO;\n        fileDTO.FileName = obj.FileName;\n        fileDTO.length = obj.length;\n        this.dirListingDTO.push(fileDTO);\n\n      });\n      //this.dirListingDTO = Object.assign({}, tmp1.fileDTOs); \n      console.info(' this.dirListingDTO', this.dirListingDTO);\n      // console.info(' this.dirListingDTO length', this.dirListingDTO.length);\n    }, error => console.error(error));\n  }\n\n  ngOnInit(): void {\n    this.id = this._Activatedroute.snapshot.paramMap.get(\"id\");\n\n    console.log(\"this.id\",this.id);\n  }\n  async restoreFile(pRestoreFileName: string): Promise<void> {\n    console.info(' pRestoreFileName', pRestoreFileName);\n    //this.httpCall(\"POST\", pRestoreFileName)\n    const response = await fetch(environment.appServerURL + \"/api/v2/requestRestore\", {\n      method: 'POST',\n      body: JSON.stringify({\n        backupName: pRestoreFileName,\n        customerGUID: this.guid,\n      }),\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Error! status: ${response.status}`);\n    }\n  }\n}\ntype GenericMsg2 = {\n  msgType: string;\n  msg: string;\n  guid: string;\n}\ninterface GenericMsg {\n  msgType: string;\n  msg: string;\n  guid: string;\n}\ninterface DirListingDTO {\n  FileName: string;\n  length: number;\n  date: string;\n}\n","<h1 id=\"tableLabel\">OffSite Directory Listing length:{{dirListingDTO.length}}</h1>\r\n\r\n\r\n\r\n<p *ngIf=\"!dirListingDTO\"><em>Loading...</em></p>\r\n\r\n<table class='table table-striped' aria-labelledby=\"tableLabel\" *ngIf=\"dirListingDTO\">\r\n  <thead>\r\n    <tr>\r\n      <th>Action</th>\r\n      <th>FileName</th>\r\n      <th>Size</th>\r\n      <th>Date</th>\r\n\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr *ngFor=\"let fileDTO of dirListingDTO\">\r\n      <td><a class=\"pure-button pure-button-primary\" (click)='restoreFile(fileDTO.FileName)'>Restore</a></td>\r\n      <td>{{ fileDTO.FileName }}</td>\r\n      <td>{{ fileDTO.length }}</td>\r\n      <td>{{ fileDTO.date }}</td>\r\n\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n"]},"metadata":{},"sourceType":"module"}